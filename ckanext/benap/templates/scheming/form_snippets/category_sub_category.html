{% import 'macros/form.html' as form %}

{% call form.input(
    field.field_name,
    id='field-' + field.field_name,
    label=h.scheming_language_text(field.label),
    placeholder=h.scheming_language_text(field.form_placeholder),
    value=data[field.field_name],
    error=errors[field.field_name],
    classes=field.classes if 'classes' in field else ['control-medium'],
    attrs=dict({"class": "form-control"}, **(field.get('form_attrs', {}))),
    is_required=h.scheming_field_required(field)
    )
%}
    {%- set lang = h.lang() -%}
    {%- set english = 'en' -%}
    {%- set choices = h.benap_get_translated_category_and_sub_category() -%}
    {%- if field.get('sorted_choices') -%}
        {%- set choices = choices|sort(case_sensitive=false, attribute=1) -%}
    {%- endif -%}
    {%- snippet 'scheming/form_snippets/help_text.html', field=field -%}

    <fieldset class="checkboxes" data-module="category-sub-category" data-module-field-id="field-{{ field.field_name }}">
        {%- for category, tags in choices -%}
            <!-- Category container with accordion and main checkbox -->
            <div class="category-container">
                <div class="flex-between border-1" style="padding: 6px 12px" id="category-{{ loop.index }}">
                    {%- for val, label in category -%}
                        <label class="m-0" style="font-size: 14px; font-weight: bold;">
                            <input type="checkbox" class="category-checkbox" data-category="{{ val }}" {{ "checked " if val in h.benap_retrieve_dict_items_or_keys_or_values(data[field.field_name], "keys") }} />
                            {{ h.benap_scheming_language_text(label, lang) }}
                        </label>
                    {%- endfor -%}
                    <span class="category-caret"></span> <!-- Icon for accordion -->
                </div>

                <!-- Tags for each category, initially hidden -->
                <div class="tag-container" id="tag-container-{{ loop.index }}">

                    {%- for val, label in tags -%}
                        <label>
                            <input type="checkbox"
                                   class="tag-checkbox"
                                   data-category="{{ category[0][0] }}"
                                   value="{{ val }}"
                                   {{ "checked " if val in h.benap_retrieve_dict_items_or_keys_or_values(data[field.field_name], "values") }}
                                   {{ "disabled " if category[0][0] not in h.benap_retrieve_dict_items_or_keys_or_values(data[field.field_name], "keys") }} />
                            {{ h.benap_scheming_language_text(label, lang) }}
                        </label>
                    {%- endfor -%}
                </div>
            </div>
        {%- endfor -%}
    </fieldset>
{%- endcall -%}
